<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç´ é—®æŠ¢ç­”æ¨¡æ‹Ÿ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script src="game-state-manager.js"></script>
  <script src="animation-manager.js"></script>
  <script src="ui-controller.js"></script>
  
  <!-- ä¸»æ¸¸æˆå®¹å™¨ -->
  <div class="quiz-container">
    <!-- åŠ åˆ†åŠ¨ç”»å®¹å™¨ï¼šç”¨äºæ˜¾ç¤ºåˆ†æ•°å¢åŠ æ—¶çš„é£è¡ŒåŠ¨ç”»æ•ˆæœ -->
    <div class="score-animation-container" id="score-animation-container"></div>
    
    <!-- é¡¶éƒ¨çŠ¶æ€æ ï¼šæ˜¾ç¤ºç©å®¶ä¿¡æ¯ã€è®¡æ—¶å™¨ã€å¯¹æ‰‹ä¿¡æ¯ -->
    <div class="header">
      <!-- ç©å®¶ä¿¡æ¯åŒºåŸŸ -->
      <div class="player-info">
        <div class="avatar">You</div>
        <div class="player-score">0</div>
      </div>
      
      <!-- è®¡æ—¶å™¨åŒºåŸŸï¼šæ˜¾ç¤ºå½“å‰é¢˜ç›®å‰©ä½™æ—¶é—´ -->
      <div class="timer-container">
        <div class="timer-circle">
          <!-- è®¡æ—¶å™¨è¿›åº¦åœ†ç¯ -->
          <div class="timer-progress"></div>
          <!-- è®¡æ—¶å™¨æ•°å­—æ˜¾ç¤º -->
          <span style="position: relative; z-index: 1;">0</span>
        </div>
      </div>
      
      <!-- å¯¹æ‰‹ä¿¡æ¯åŒºåŸŸ -->
      <div class="opponent-info">
        <div class="opponent-score">
          <div class="score-number">0</div>
        </div>
        <div class="opponent-avatar"></div>
      </div>
    </div>

    <!-- è½®æ¬¡æç¤ºæ–‡æœ¬ï¼šæ˜¾ç¤ºå½“å‰é¢˜ç›®è½®æ¬¡æˆ–æ¸¸æˆçŠ¶æ€ -->
    <div class="rank-text" id="rank-text"></div>
    
    <!-- é¢˜ç›®åŒºåŸŸï¼šåŒ…å«é¢˜ç›®å†…å®¹ã€é€‰é¡¹ã€è¿›åº¦æ¡ -->
    <div class="question-section">
      <!-- å·¦ä¾§è¿›åº¦æ¡ï¼šæ˜¾ç¤ºç©å®¶å½“å‰åˆ†æ•°è¿›åº¦ -->
      <div class="progress-bar left-progress">
        <div class="progress-fill" id="left-progress-fill"></div>
      </div>
      
      <!-- é¢˜ç›®å†…å®¹åŒºåŸŸ -->
      <div class="question-content">
        <!-- é¢˜ç›®æ–‡æœ¬ -->
        <div class="question-text">
          å½“ä¸€ä¸ªäººè®¤ä¸º"äººäººéƒ½åœ¨æ¬ºè´Ÿæˆ‘"æ—¶,æœ€éœ€è¦åæ€çš„æ˜¯ä»€ä¹ˆ?
        </div>
        
        <!-- é€‰é¡¹å®¹å™¨ï¼šåŒ…å«4ä¸ªç­”é¢˜é€‰é¡¹ -->
        <div class="options-container">
          <!-- é€‰é¡¹1ï¼šåŒ…å«é€‰é¡¹æ–‡æœ¬å’Œå¯¹æ‰‹ç»“æœå›¾æ ‡ -->
          <div class="option" data-option="1">
            <div class="option-text">ç¤¾ä¼šç¼ºä¹å¯¹å¼±è€…çš„ä¿æŠ¤æœºåˆ¶</div>
            <div class="opponent-result" data-option="1"></div>
          </div>
          
          <!-- é€‰é¡¹2 -->
          <div class="option" data-option="2">
            <div class="option-text">æ˜¯å¦ä¾µçŠ¯äº†taäººçš„åˆæ³•è‡ªç”±</div>
            <div class="opponent-result" data-option="2"></div>
          </div>
          
          <!-- é€‰é¡¹3 -->
          <div class="option" data-option="3">
            <div class="option-text">è‡ªèº«å®åŠ›å¼±å°,æ— æ³•å½¢æˆæœ‰æ•ˆå¨æ…‘</div>
            <div class="opponent-result" data-option="3"></div>
          </div>
          
          <!-- é€‰é¡¹4 -->
          <div class="option" data-option="4">
            <div class="option-text">taäººæ™®éå­˜åœ¨çš„æ•Œæ„</div>
            <div class="opponent-result" data-option="4"></div>
          </div>
        </div>
      </div>
      
      <!-- å³ä¾§è¿›åº¦æ¡ï¼šæ˜¾ç¤ºå¯¹æ‰‹å½“å‰åˆ†æ•°è¿›åº¦ -->
      <div class="progress-bar right-progress">
        <div class="progress-fill" id="right-progress-fill"></div>
      </div>
    </div>
    <!-- ç»“æŸç•Œé¢ï¼šæ˜¾ç¤ºèƒœè´Ÿé¢œæ–‡å­—ä¸ç»§ç»­æŒ‘æˆ˜æŒ‰é’® -->
    <div class="end-screen" id="end-screen" style="display: none;">
      <div class="end-title" id="end-title">å¹³å±€</div>
      <div class="end-emoji" id="end-emoji">(-__-Â°)</div>
      <button class="cta-button primary" id="continue-button">ç»§ç»­æŒ‘æˆ˜</button>
    </div>
    
  </div>

    <!-- åº•éƒ¨é¢˜åº“æ¥æºå£°æ˜ -->
    <div class="footer-attribution">
      <p>é¢˜åº“æ¥æºï¼š<a href="https://sooon.ai/" target="_blank">ç´ é—®</a>ï¼Œè¯¦è§
        <a href="about.html" >å…³äº</a>
      </p>
    </div>
  <script>
    /**
     * ç­”é¢˜å¯¹æˆ˜æ¸¸æˆä¸»è„šæœ¬
     * è´Ÿè´£åˆå§‹åŒ–æ¸¸æˆç»„ä»¶å’Œåè°ƒå„æ¨¡å—ä¹‹é—´çš„äº¤äº’
     */
    
    // å…¨å±€å˜é‡ï¼šå­˜å‚¨æ¸¸æˆæ ¸å¿ƒç»„ä»¶å®ä¾‹
    let gameStateManager;  // çŠ¶æ€ç®¡ç†å™¨å®ä¾‹
    let uiController;      // UIæ§åˆ¶å™¨å®ä¾‹

    /**
     * é€‰é¡¹åŠ¨ç”»å®Œæˆäº‹ä»¶å¤„ç†
     * ç¡®ä¿é€‰é¡¹åœ¨CSSåŠ¨ç”»å®Œæˆåæ­£ç¡®æ˜¾ç¤º
     */
    document.querySelectorAll('.option').forEach(option => {
      option.addEventListener('animationend', function() {
        this.classList.add('animate-in');
      });
    });

    /**
     * é¡µé¢åŠ è½½å®Œæˆäº‹ä»¶å¤„ç†
     * åˆå§‹åŒ–æ¸¸æˆç»„ä»¶å¹¶å¼€å§‹æ¸¸æˆæµç¨‹
     */
    document.addEventListener('DOMContentLoaded', function() {
      console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æ¸¸æˆ...');
      
      // 1. åˆ›å»ºçŠ¶æ€ç®¡ç†å™¨å®ä¾‹
      // è´Ÿè´£ç®¡ç†æ¸¸æˆçš„æ‰€æœ‰çŠ¶æ€ï¼šåˆ†æ•°ã€è½®æ¬¡ã€é¢˜ç›®ã€è®¡æ—¶å™¨ç­‰
      gameStateManager = new GameStateManager();
      
      // 2. åˆ›å»ºUIæ§åˆ¶å™¨å®ä¾‹
      // è´Ÿè´£è¿æ¥çŠ¶æ€ç®¡ç†å™¨å’ŒDOMæ“ä½œï¼Œå¤„ç†æ‰€æœ‰UIæ›´æ–°
      uiController = new UIController(gameStateManager);
      
      // 3. è®¾ç½®åˆå§‹æ¸¸æˆçŠ¶æ€
      // æ¯æ¬¡è¿›å…¥é¡µé¢éƒ½è§†ä¸ºä¸€å±€æ–°æ¸¸æˆï¼Œé‡ç½®æ‰€æœ‰åˆ†æ•°
      const initialPlayerScore = 0;    // ç©å®¶åˆå§‹åˆ†æ•°
      const initialOpponentScore = 0;  // å¯¹æ‰‹åˆå§‹åˆ†æ•°
      const initialTimeLeft = 150;     // åˆå§‹å€’è®¡æ—¶ï¼ˆç§’ï¼‰
      
      // æ›´æ–°çŠ¶æ€ç®¡ç†å™¨ä¸­çš„åˆå§‹çŠ¶æ€
      gameStateManager.updateState({
        playerScore: initialPlayerScore,
        opponentScore: initialOpponentScore,
        timeLeft: initialTimeLeft
      });

      // 3.1 é…ç½®å¯¹æ‰‹å‚æ•°ï¼ˆå¤´åƒã€AIå‡†ç¡®ç‡ã€é€‰æ‹©é€Ÿåº¦ï¼‰
      // ç¤ºä¾‹ï¼š70%æ­£ç¡®ç‡ï¼Œ0.4s~1.2s éšæœºä½œç­”å»¶è¿Ÿï¼Œå¤´åƒä¸ºemoji
      gameStateManager.configureOpponent({
        avatar: 'ğŸ¤–',
        ai: { accuracy: 0.7, speedMsRange: [1280, 2900] }
      });
      
      // 4. ç«‹å³æ›´æ–°UIæ˜¾ç¤º
      // ç¡®ä¿é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ­£ç¡®çš„åˆå§‹çŠ¶æ€
      setTimeout(() => {
        uiController.updatePlayerScore(initialPlayerScore);
        uiController.updateOpponentScore(initialOpponentScore);
        
        uiController.updateTimer(initialTimeLeft);
        // åŒæ­¥ä¸€æ¬¡å¤´åƒæ˜¾ç¤º
        uiController.updateOpponentAvatar(gameStateManager.getState('opponent')?.avatar);
        console.log('UIåˆå§‹åŒ–å®Œæˆï¼Œå€’è®¡æ—¶è®¾ç½®ä¸º', initialTimeLeft, 'ç§’');
      }, 100);
        
      // 5. å¼€å§‹æ–°ä¸€å±€æ¸¸æˆ
      // å»¶è¿Ÿ500mså¼€å§‹æ¸¸æˆï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½å·²æ­£ç¡®åˆå§‹åŒ–
      setTimeout(() => {
        gameStateManager.startNewGame();
        console.log('æ¸¸æˆå¼€å§‹ï¼');
      }, 500);
        
      console.log('æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');

      // æš´éœ²è°ƒè¯•å‡½æ•°åˆ°å…¨å±€ï¼šwindow.debugSettle(0|1|2)
      window.debugSettle = function(mode){
        if (!gameStateManager) return;
        if (typeof gameStateManager.debugSettle === 'function') {
          gameStateManager.debugSettle(Number(mode));
        }
      };
      // æ§åˆ¶å°è¾“å‡ºå¤§æç¤ºè¯´æ˜å¯è®¾ç½®çš„mode
      console.log('å¯è®¾ç½®çš„mode: 0-å¹³å±€, 1-ç©å®¶èƒœ, 2-å¯¹æ‰‹èƒœ');
      console.log('æ–¹æ³•ï¼šdebugSettle(0|1|2)');
    });
    
    /**
     * é¡µé¢å¸è½½äº‹ä»¶å¤„ç†
     * æ¸…ç†èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
     */
    window.addEventListener('beforeunload', function() {
      console.log('é¡µé¢å³å°†å¸è½½ï¼Œå¼€å§‹æ¸…ç†èµ„æº...');
      
      // æ¸…ç†çŠ¶æ€ç®¡ç†å™¨
      if (gameStateManager) {
        gameStateManager.destroy();
        console.log('çŠ¶æ€ç®¡ç†å™¨å·²æ¸…ç†');
      }
      
      // æ¸…ç†UIæ§åˆ¶å™¨
      if (uiController) {
        uiController.destroy();
        console.log('UIæ§åˆ¶å™¨å·²æ¸…ç†');
      }
      
      console.log('èµ„æºæ¸…ç†å®Œæˆ');
    });
  </script>
</body>
</html>